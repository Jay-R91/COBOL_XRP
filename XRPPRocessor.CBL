IDENTIFICATION DIVISION.
PROGRAM-ID. XRP-PROCESSOR.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT BALANCE-FILE ASSIGN TO "balance.dat"
        ORGANIZATION IS LINE SEQUENTIAL
        ACCESS MODE IS SEQUENTIAL
        FILE STATUS IS FILE-STATUS

DATA DIVISION.
FILE SECTION.
FD BALANCE-FILE.
01 BALANCE-RECORD.
    05 BALANCE-AMOUNT   PIC 9(5)V99.

WORKING-STORAGE SECTION.
01 FILE-STATUS          PIC X(2).
01 WS-BALANCE           PIC 9(5)V99.
01 WS-AMOUNT            PIC 9(5)V99.
01 WS-SENDER            PIC X(20).
01 WS-RECEIVER          PIC X(20).
01 WS-OUTPUT-RECORD     PIC Z(5)9.99.

PROCEDURE DIVISION.
MAIN-PROCEDURE SECTION.
    PERFORM INITIALIZE-BALANCE
    PERFORM GET-USER-INPUT
    PERFORM PROCESS-TRANSACTION
    STOP RUN.

INITIALIZE-BALANCE SECTION.
    OPEN INPUT BALANCE-FILE
    IF FILE-STATUS = "35" OR FILE-STATUS = "05"
        CLOSE BALANCE-FILE
        MOVE 10000.00 TO WS-BALANCE
        OPEN OUTPUT BALANCE-FILE
        MOVE WS-BALANCE TO BALANCE-AMOUNT
        MOVE BALANCE-AMOUNT TO WS-OUTPUT-RECORD
        WRITE BALANCE-RECORD FROM WS-OUTPUT-RECORD
        CLOSE BALANCE-FILE
    ELSE
        IF FILE-STATUS = "00"
            READ BALANCE-FILE
                AT END
                    MOVE 10000.00 TO WS-BALANCE
                    CLOSE BALANCE-FILE
                    OPEN OUTPUT BALANCE-FILE
                    MOVE WS-BALANCE TO BALANCE-AMOUNT
                    MOVE BALANCE-AMOUNT TO WS-OUTPUT-RECORD
                    WRITE BALANCE-RECORD FROM WS-OUTPUT-RECORD
                    CLOSE BALANCE-FILE
                NOT AT END
                    MOVE BALANCE-AMOUNT TO WS-BALANCE
            END-READ
            CLOSE BALANCE-FILE
        ELSE
            DISPLAY "Error opening balance.dat: " FILE-STATUS
            STOP RUN
        END-IF
    END-IF.

GET-USER-INPUT SECTION.
    DISPLAY "Current Balance: $" WS-BALANCE
    DISPLAY "Enter sender name: "
    ACCEPT WS-SENDER
    DISPLAY "Enter receiver name: "
    ACCEPT WS-RECEIVER
    DISPLAY "Enter amount to send: "
    ACCEPT WS-AMOUNT.

PROCESS-TRANSACTION SECTION.
    IF WS-AMOUNT IS NUMERIC
        IF WS-AMOUNT > WS-BALANCE
            DISPLAY "Insufficient funds. Transaction cancelled."
        ELSE
            SUBTRACT WS-AMOUNT FROM WS-BALANCE
            OPEN OUTPUT BALANCE-FILE
            MOVE WS-BALANCE TO BALANCE-AMOUNT
            MOVE BALANCE-AMOUNT TO WS-OUTPUT-RECORD
            WRITE BALANCE-RECORD FROM WS-OUTPUT-RECORD
            CLOSE BALANCE-FILE
            DISPLAY "Processing transaction..."
            DISPLAY "From: " WS-SENDER
            DISPLAY "To: " WS-RECEIVER
            DISPLAY "Amount: $" WS-AMOUNT
            DISPLAY "New Balance: $" WS-BALANCE
            DISPLAY "Transaction sent successfully!"
        END-IF
    ELSE
        DISPLAY "Invalid amount entered. Must be a number."
    END-IF.

END PROGRAM XRP-PROCESSOR.
