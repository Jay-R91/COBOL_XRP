IDENTIFICATION DIVISION.
PROGRAM-ID. XRP-PROCESSOR.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT BALANCE-FILE ASSIGN TO "balance.dat"
        ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.

FILE SECTION.
FD BALANCE-FILE.
01 BALANCE-RECORD       PIC Z(4)9.99.

WORKING-STORAGE SECTION.
01 AMOUNT               PIC Z(4)9.99.
01 SENDER               PIC X(20).
01 RECEIVER             PIC X(20).
01 EOF-FLAG             PIC X VALUE 'N'.
   88 END-OF-FILE       VALUE 'Y'.
   88 NOT-END-OF-FILE   VALUE 'N'.

PROCEDURE DIVISION.
    PERFORM INIT-BALANCE.
    PERFORM PROCESS-TRANSACTION.
    STOP RUN.

INIT-BALANCE.
    OPEN INPUT BALANCE-FILE
        ON EXCEPTION
            MOVE 10000.00 TO BALANCE-RECORD.
            OPEN OUTPUT BALANCE-FILE.
            WRITE BALANCE-RECORD.
            CLOSE BALANCE-FILE.
            OPEN INPUT BALANCE-FILE.
    END-EXCEPTION.

    READ BALANCE-FILE
        AT END
            MOVE 10000.00 TO BALANCE-RECORD.
    END-READ.

    CLOSE BALANCE-FILE.

PROCESS-TRANSACTION.
    DISPLAY "Current Balance: $" BALANCE-RECORD.
    DISPLAY "Enter sender name: ".
    ACCEPT SENDER.
    DISPLAY "Enter receiver name: ".
    ACCEPT RECEIVER.
    DISPLAY "Enter amount to send: ".
    ACCEPT AMOUNT.

    IF AMOUNT IS NOT NUMERIC
        DISPLAY "Invalid amount entered. Must be a number."
        STOP RUN.
    END-IF.

    EVALUATE TRUE
        WHEN AMOUNT > BALANCE-RECORD
            DISPLAY "Insufficient funds. Transaction cancelled.".
        WHEN OTHER
            SUBTRACT AMOUNT FROM BALANCE-RECORD.
            DISPLAY "Processing transaction...".
            DISPLAY "From: " SENDER.
            DISPLAY "To: " RECEIVER.
            DISPLAY "Amount: $" AMOUNT.
            DISPLAY "New Balance: $" BALANCE-RECORD.
            OPEN OUTPUT BALANCE-FILE.
            WRITE BALANCE-RECORD.
            CLOSE BALANCE-FILE.
            DISPLAY "Transaction sent successfully!".
    END-EVALUATE.

    STOP RUN.
